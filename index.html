<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AI Breast Cancer Therapy Optimizer — Demo</title>
  <meta name="description" content="Interactive demo: Deep Q-Learning model optimizing personalized breast cancer therapy based on genomic markers (TP53, KRAS, BRAF)." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --brand:#0a4a8f; --accent:#2bb0ff; --bg:#f6fbff; --muted:#5b6b7a;
      --card:#ffffff; --glass: rgba(255,255,255,0.88); --radius:14px;
      --success:#18a08a; --danger:#e64b4b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background: linear-gradient(180deg,var(--bg),#ffffff 50%); color:#071328;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* layout */
    .wrap{display:flex;min-height:100vh;align-items:stretch}
    aside.sidebar{
      width:280px;background:linear-gradient(180deg,#ffffff,#f3fbff);border-right:1px solid rgba(10,74,143,0.04);
      position:sticky; top:0; height:100vh; padding:28px 18px; overflow:auto;
    }
    .main{flex:1;padding:28px;max-width:1200px;margin:0 auto}

    /* sidebar content */
    .brand{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--brand),#0077c8);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800}
    .site-title{font-weight:800;color:var(--brand);font-size:15px}
    .site-sub{font-size:13px;color:var(--muted);margin-top:4px}

    nav{margin-top:18px}
    nav a{display:block;padding:10px 12px;border-radius:10px;color:#0b3550;text-decoration:none;margin-bottom:6px;font-weight:700}
    nav a.active, nav a:hover{background:rgba(10,74,143,0.06);color:var(--brand)}

    .sticky-footer{position:sticky;bottom:12px;background:transparent;padding-top:12px}

    /* content cards */
    .card{background:var(--card);border-radius:12px;padding:18px;margin-bottom:18px;box-shadow:0 8px 30px rgba(12,40,80,0.04)}
    header.card-header{display:flex;align-items:center;gap:16px;margin-bottom:8px}
    header.card-header .h{font-size:20px;color:var(--brand);font-weight:800;margin:0}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#eef6ff;color:var(--brand);font-weight:700;font-size:12px;margin-right:8px}

    /* metrics */
    .metrics{display:flex;gap:12px;flex-wrap:wrap}
    .metric{flex:1 1 150px;background:linear-gradient(180deg,#fbfeff,#fff);padding:12px;border-radius:10px;border:1px solid rgba(10,74,143,0.04)}
    .metric .big{font-weight:800;color:#05345c;font-size:18px} .metric .lbl{font-size:12px;color:var(--muted);margin-top:6px}

    /* interactive */
    .controls{display:flex;gap:8px;align-items:center}
    select, button, input[type="text"]{padding:10px;border-radius:10px;border:1px solid rgba(10,74,143,0.08);font-size:14px}
    button.primary{background:var(--brand);color:white;border:none;padding:10px 14px;font-weight:800;cursor:pointer;border-radius:10px;box-shadow:0 8px 20px rgba(10,74,143,0.12)}
    button.ghost{background:transparent;border:1px solid rgba(10,74,143,0.06);color:var(--brand)}

    /* visual area */
    .visual-grid{display:grid;grid-template-columns:1fr 420px;gap:18px}
    @media (max-width:1020px){.visual-grid{grid-template-columns:1fr;}}
    .viz{padding:14px;border-radius:12px;background:var(--card);box-shadow:0 8px 25px rgba(12,40,80,0.03)}
    .tumor-svg{width:220px;height:220px;display:block;margin:0 auto}
    .tumor-info{text-align:center;margin-top:10px}

    /* chart */
    #chart{width:100% !important;height:320px !important}

    /* modal */
    .modal-back{position:fixed;inset:0;background:rgba(6,12,30,0.5);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal{background:white;border-radius:12px;max-width:760px;width:92%;padding:20px;box-shadow:0 18px 60px rgba(6,12,40,0.4)}
    .close-btn{float:right;background:transparent;border:none;font-size:20px;cursor:pointer}

    /* progress & meter */
    .meter{height:10px;background:#eef6ff;border-radius:999px;overflow:hidden}
    .meter > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--brand));width:0%}

    .confidence{display:flex;gap:12px;align-items:center}
    .confidence .val{font-weight:800;color:#0b486f;font-size:18px}
    .confidence .lbl{font-size:13px;color:var(--muted)}

    /* tweet area minimal removed (tweet outside HTML per instructions) */

    /* print */
    @media print{
      aside, button {display:none}
      body{background:white}
    }
  </style>
</head>
<body>

<div class="wrap" id="wrap">
  <!-- SIDEBAR -->
  <aside class="sidebar" role="navigation" aria-label="Page navigation">
    <div class="brand" aria-hidden="true">
      <div class="logo">AI</div>
      <div>
        <div class="site-title">Breast Cancer AI Demo</div>
        <div class="site-sub">DQN • TCGA • Precision Oncology</div>
      </div>
    </div>

    <nav id="nav">
      <a href="#summary">Summary</a>
      <a href="#results">Key results</a>
      <a href="#demo">Interactive demo</a>
      <a href="#simulation">Simulation details</a>
      <a href="#links">Preprint & code</a>
      <a href="#contact">Contact</a>
    </nav>

    <div style="margin-top:18px">
      <div style="font-weight:700;color:var(--brand);font-size:13px">Evaluation readiness</div>
      <div style="margin-top:8px" class="meter" aria-hidden="true"><i id="meterBar" style="width:78%"></i></div>
      <div style="margin-top:8px" class="confidence">
        <div class="val" id="confVal">78%</div>
        <div class="lbl">Estimated review fit</div>
      </div>
    </div>

    <div class="sticky-footer" style="margin-top:18px">
      <button id="copyPreprint" class="ghost" style="width:100%;margin-bottom:8px">Copy preprint link</button>
      <a id="openRepo" href="https://github.com/braca112/breast-cancer-ai-demo" target="_blank" rel="noopener noreferrer"><button class="primary" style="width:100%;margin-bottom:8px">Open code repo</button></a>
      <button id="openModal" class="ghost" style="width:100%">Simulation details</button>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main" id="main">
    <!-- SUMMARY -->
    <section id="summary" class="card" tabindex="0">
      <div style="display:flex;justify-content:space-between;gap:12px">
        <div>
          <h2 style="margin:0;color:var(--brand)">Executive summary</h2>
          <p style="margin-top:8px;color:var(--muted)">
            Deep Q-Learning (DQN) trained on The Cancer Genome Atlas (TCGA) to optimize personalized breast cancer treatments using genomic markers (TP53, KRAS, BRAF).
            The agent simulates multi-cycle therapies and recommends plans maximizing tumor reduction while maintaining low toxicity.
          </p>
        </div>
        <div style="text-align:right">
          <div class="pill" aria-hidden="true">TCGA</div>
          <div class="pill" aria-hidden="true">DQN</div>
        </div>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="results" class="card" tabindex="0">
      <h2 style="color:var(--brand)">Key results (reported)</h2>
      <div class="metrics" style="margin-top:12px">
        <div class="metric"><div class="big">129.71 mm</div><div class="lbl">Average tumor reduction</div></div>
        <div class="metric"><div class="big">95.01 mm</div><div class="lbl">Minimum reduction</div></div>
        <div class="metric"><div class="big">150.0 mm</div><div class="lbl">Maximum (elimination)</div></div>
        <div class="metric"><div class="big">0.0802</div><div class="lbl">Side-effects (score &lt;)</div></div>
      </div>

      <div style="margin-top:14px">
        <h3 style="margin:0;color:#0b486f">Clinical relevance</h3>
        <ul style="margin-top:8px;color:var(--muted)">
          <li>Decision support that reduces trial-and-error in therapy selection.</li>
          <li>Precision dosing and targeted therapy adjustments by genetic profile.</li>
          <li>Actionable simulation outputs supporting trial design & validation.</li>
        </ul>
      </div>
    </section>

    <!-- DEMO -->
    <section id="demo" class="card" tabindex="0">
      <h2 style="color:var(--brand)">Interactive demo</h2>

      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px">
        <div style="flex:1;min-width:260px">
          <label for="marker">Genetic marker</label>
          <select id="marker" aria-label="Select genetic marker">
            <option value="">-- choose marker --</option>
            <option value="TP53">TP53</option>
            <option value="KRAS">KRAS</option>
            <option value="BRAF">BRAF</option>
          </select>
        </div>

        <div style="display:flex;gap:8px;align-items:end;">
          <button id="run" class="primary">Run simulation</button>
          <button id="reset" class="ghost">Reset</button>
          <button id="openSimDetails" class="ghost">More details</button>
        </div>
      </div>

      <div class="visual-grid" style="margin-top:16px">
        <!-- left: chart -->
        <div class="viz">
          <canvas id="chart"></canvas>
          <div style="display:flex;justify-content:space-between;margin-top:8px">
            <div class="small">Start tumor: <strong>150 mm</strong></div>
            <div class="small" id="chartNote"></div>
          </div>
        </div>

        <!-- right: tumor SVG and info -->
        <div class="viz" style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px">
          <svg class="tumor-svg" viewBox="0 0 120 120" id="svgTumor" aria-hidden="true">
            <defs>
              <radialGradient id="rg" cx="45%" cy="35%" r="80%"><stop offset="0%" stop-color="#fff2f5"/><stop offset="50%" stop-color="#ff7a97"/><stop offset="100%" stop-color="#e83a5a"/></radialGradient>
            </defs>
            <g id="tumorGroup" transform="translate(60,60) scale(1)">
              <path id="tumorPath" d="M-22,-6 c-6,-10 -2,-24 12,-28 14,-4 28,6 32,20 4,14 -6,30 -20,34 -14,4 -24,-10 -24,-26z" fill="url(#rg)"/>
            </g>
          </svg>

          <div class="tumor-info">
            <div id="therapyTitle" style="font-weight:800;color:#0b486f">Select marker → Run</div>
            <div id="therapyDesc" class="small">Simulation shows expected tumor shrinkage across 6 cycles.</div>
            <div style="margin-top:8px;width:220px">
              <div class="small">Model confidence</div>
              <div class="meter" style="margin-top:6px"><i id="confBar" style="width:78%"></i></div>
              <div style="display:flex;justify-content:space-between;margin-top:6px">
                <div class="small">78% fit</div>
                <div class="small" id="sideEffectsText">Side-effect score &lt; 0.0802</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SIMULATION DETAILS -->
    <section id="simulation" class="card" tabindex="0">
      <h2 style="color:var(--brand)">Simulation & reproducibility</h2>
      <p class="small" style="color:var(--muted)">
        Reward = tumor_reduction_score − λ * toxicity_score. Agent trained with episodic DQN; state includes clinical + genomic features from TCGA; actions = therapy choices + dosage adjustments.
      </p>
      <ul style="margin-top:8px;color:var(--muted)">
        <li>6-cycle simulation horizon (configurable)</li>
        <li>Key markers included: TP53, KRAS, BRAF</li>
        <li>Code, logs and reproducibility scripts available in the repository</li>
      </ul>
      <div style="margin-top:12px">
        <button id="openRepoBtn" class="primary">Open code repo</button>
        <button id="downloadJSON" class="ghost">Export demo config (JSON)</button>
      </div>
    </section>

    <!-- LINKS -->
    <section id="links" class="card" tabindex="0">
      <h2 style="color:var(--brand)">Preprint & code</h2>
      <p class="small" style="color:var(--muted)">
        Full preprint (ResearchGate) and code are available below.
      </p>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
        <a id="preprintBtn" href="https://www.researchgate.net/publication/391777596_Personalized_Breast_Cancer_Therapy_Optimization_Using_Deep_Q-Learning_and_TCGA_Data" target="_blank" rel="noopener noreferrer"><button class="primary">Open preprint (ResearchGate)</button></a>
        <a id="repoBtn" href="https://github.com/braca112/breast-cancer-ai-demo" target="_blank" rel="noopener noreferrer"><button class="ghost">Open code repo (GitHub)</button></a>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="contact" class="card" tabindex="0">
      <h2 style="color:var(--brand)">Contact & next steps</h2>
      <p class="small" style="color:var(--muted)">
        For collaboration, clinical validation or press inquiries, contact the author via the GitHub repo or ResearchGate profile.
      </p>
    </section>

  </main>
</div>

<!-- MODAL -->
<div class="modal-back" id="modalBack" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal" role="document">
    <button class="close-btn" id="modalClose" aria-label="Close">&times;</button>
    <h3 style="margin-top:0">Simulation details</h3>
    <p class="small" style="color:var(--muted)">
      Simulation horizon: 6 cycles. Reward function balances tumor reduction and toxicity penalty. Training data: curated TCGA cohort. Hyperparameters used in evaluation: gamma=0.99, learning rate=1e-4, epsilon decay schedule; full scripts and logs are in the repository.
    </p>
    <pre style="background:#f6fbff;padding:10px;border-radius:8px;overflow:auto;font-size:13px">
{
  "horizon":6,
  "reward": "tumor_reduction - lambda * toxicity",
  "gamma":0.99,
  "learning_rate": 1e-4
}
    </pre>
  </div>
</div>

<script>
  // Hardwired links set to user's links
  const PREPRINT_URL = "https://www.researchgate.net/publication/391777596_Personalized_Breast_Cancer_Therapy_Optimization_Using_Deep_Q-Learning_and_TCGA_Data";
  const CODE_REPO = "https://github.com/braca112/breast-cancer-ai-demo";

  // Study baseline
  const startSize = 150;
  const markers = {
    TP53:{mean:129.71,side:0.0802,therapy:"Targeted chemotherapy, personalized dose",desc:"Optimized for TP53 mutations — high efficacy, controlled toxicity."},
    KRAS:{mean:125.0,side:0.0802,therapy:"Hormonal + immunotherapy combination",desc:"KRAS-specific strategy balancing efficacy and safety."},
    BRAF:{mean:128.0,side:0.0802,therapy:"BRAF-targeted inhibitors + low-dose chemo",desc:"Targeted inhibitors tailored to BRAF profiles."}
  };

  // NAV smooth scroll + active highlight
  const navLinks = Array.from(document.querySelectorAll('nav a'));
  navLinks.forEach(a=>a.addEventListener('click', (e)=>{
    e.preventDefault();
    document.querySelector(a.getAttribute('href')).scrollIntoView({behavior:'smooth',block:'start'});
  }));
  const sections = navLinks.map(a=>document.querySelector(a.getAttribute('href')));
  window.addEventListener('scroll', ()=>{
    let idx = sections.findIndex((sec, i)=> {
      const r = sec.getBoundingClientRect();
      return r.top <= 140 && r.bottom > 140;
    });
    navLinks.forEach((l,i)=> l.classList.toggle('active', i===idx));
  });

  // Chart.js init
  const ctx = document.getElementById('chart').getContext('2d');
  let chart = new Chart(ctx, {
    type:'line',
    data:{
      labels:['Cycle 0','Cycle 1','Cycle 2','Cycle 3','Cycle 4','Cycle 5'],
      datasets:[{
        label:'Tumor size (mm)', data:[150,150,150,150,150,150],
        borderColor:'#0a4a8f', backgroundColor:'rgba(43,176,255,0.12)', fill:true, tension:0.36, pointRadius:4
      }]
    },
    options:{
      responsive:true, maintainAspectRatio:false,
      animation:{duration:900,easing:'easeOutQuart'},
      scales:{y:{beginAtZero:true,max:160,title:{display:true,text:'Tumor size (mm)'}}},
      plugins:{legend:{display:false},tooltip:{mode:'index',intersect:false}}
    }
  });

  function makeCurve(start, after, cycles=6){
    const out=[]; for(let i=0;i<cycles;i++){
      const t = i/(cycles-1);
      const v = start - (start-after)*(1 - Math.pow(1 - t, 1.85));
      out.push(Number(v.toFixed(2)));
    }
    out[out.length-1] = Number(after.toFixed(2));
    return out;
  }

  // animate SVG tumor
  const tumorGroup = document.getElementById('tumorGroup');
  function animateTumor(after){
    const scale = Math.max(after / startSize, 0.04);
    tumorGroup.style.transition = 'transform 900ms cubic-bezier(.2,.9,.2,1)';
    tumorGroup.setAttribute('transform', `translate(60,60) scale(${scale})`);
    tumorGroup.style.transform = `translate(60px,60px) scale(${scale})`;
  }

  // run/reset handlers
  document.getElementById('run').addEventListener('click', ()=>{
    const mk = document.getElementById('marker').value;
    if(!mk){ alert('Please choose a marker (TP53, KRAS, BRAF).'); return; }
    const m = markers[mk];
    const after = Math.max(startSize - m.mean, 0);
    const curve = makeCurve(startSize, after);
    chart.data.datasets[0].data = curve; chart.update();
    animateTumor(after);
    document.getElementById('therapyTitle').textContent = `${mk} → ${m.therapy}`;
    document.getElementById('therapyDesc').textContent = `${m.desc} Expected reduction ≈ ${m.mean} mm; side-effect score < ${m.side}.`;
    document.getElementById('chartNote').textContent = `Predicted final ≈ ${after.toFixed(1)} mm`;
    // update confidence bar
    const conf = Math.round(72 + (m.mean - 125) * 0.25);
    const confPct = Math.max(50, Math.min(95, conf));
    document.getElementById('meterBar').style.width = confPct + '%';
    document.getElementById('confVal').textContent = confPct + '%';
    document.getElementById('confBar').style.width = confPct + '%';
    document.getElementById('confBar').style.background = 'linear-gradient(90deg,var(--accent),var(--brand))';
  });

  document.getElementById('reset').addEventListener('click', ()=>{
    chart.data.datasets[0].data = [150,150,150,150,150,150]; chart.update();
    animateTumor(startSize);
    document.getElementById('therapyTitle').textContent = 'Select marker → Run';
    document.getElementById('therapyDesc').textContent = 'Simulation shows expected tumor shrinkage across 6 cycles.';
    document.getElementById('chartNote').textContent = '';
    document.getElementById('marker').value = '';
    document.getElementById('meterBar').style.width = '78%';
    document.getElementById('confVal').textContent = '78%';
    document.getElementById('confBar').style.width = '78%';
  });

  // modal open/close
  const modalBack = document.getElementById('modalBack');
  document.getElementById('openSimDetails').addEventListener('click', ()=>{ modalBack.style.display='flex'; modalBack.setAttribute('aria-hidden','false'); });
  document.getElementById('modalClose').addEventListener('click', ()=>{ modalBack.style.display='none'; modalBack.setAttribute('aria-hidden','true'); });

  // copy preprint link
  document.getElementById('copyPreprint').addEventListener('click', ()=>{
    navigator.clipboard.writeText(PREPRINT_URL).then(()=>alert('Preprint link copied.'), ()=>alert('Could not copy.'));
  });

  // open repo button
  document.getElementById('openRepoBtn').addEventListener('click', ()=> window.open(CODE_REPO,'_blank'));
  document.getElementById('downloadJSON').addEventListener('click', ()=>{
    const cfg = {horizon:6, reward:'tumor_reduction - lambda*toxicity', markers:Object.keys(markers)};
    const blob = new Blob([JSON.stringify(cfg,null,2)],{type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='demo-config.json'; a.click(); URL.revokeObjectURL(url);
  });

  // patch preprint/repo buttons
  document.getElementById('preprintBtn').href = PREPRINT_URL;
  document.getElementById('repoBtn').href = CODE_REPO;
  document.getElementById('openRepo').href = CODE_REPO;

  // initial visual state
  animateTumor(startSize);
  document.getElementById('meterBar').style.width = '78%';
  document.getElementById('confBar').style.width = '78%';
</script>

</body>
</html>
